# üîê –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ CRM

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 21.06.2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞
–†–∞–Ω–µ–µ –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Spody –º–æ–≥ –≤–æ–π—Ç–∏ –≤ CRM –ø–∞–Ω–µ–ª—å, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ —Å–µ—Ä—å–µ–∑–Ω—É—é —É–≥—Ä–æ–∑—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π `admin_users`, –∫–æ—Ç–æ—Ä–∞—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ CRM.

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
   - –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç Spody

2. **–û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor**
   - –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ "SQL Editor"
   - –ù–∞–∂–º–∏—Ç–µ "New query"

3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `CRM_ADMIN_USERS_MIGRATION.sql`
   - –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
   - –ù–∞–∂–º–∏—Ç–µ "Run"

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

1. **–ù–∞–π–¥–∏—Ç–µ –≤–∞—à User ID**
   ```sql
   SELECT id, email FROM auth.users WHERE email = '–≤–∞—à-email@example.com';
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ–±—è –∫–∞–∫ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞**
   ```sql
   INSERT INTO public.admin_users (user_id, email, role, is_active, created_by)
   SELECT 
     id as user_id,
     email,
     'super_admin' as role,
     true as is_active,
     id as created_by
   FROM auth.users 
   WHERE email = '–≤–∞—à-email@example.com'  -- –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® EMAIL
   ON CONFLICT (email) DO NOTHING;
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
   ```sql
   SELECT * FROM public.admin_users;
   ```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

1. **–í—ã–π–¥–∏—Ç–µ –∏–∑ CRM** (–µ—Å–ª–∏ –≤—ã –≤–æ—à–ª–∏)
2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏** —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –æ—Ç–∫–∞–∑: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ CRM."
3. **–í–æ–π–¥–∏—Ç–µ —Å –∞–¥–º–∏–Ω—Å–∫–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø

### –®–∞–≥ 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ CRM** ‚Üí `/admin-users`
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
3. **–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã admin_users

```sql
CREATE TABLE public.admin_users (
  id UUID PRIMARY KEY,                    -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–ø–∏—Å–∏
  user_id UUID REFERENCES auth.users,    -- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Supabase
  email VARCHAR(255) UNIQUE,             -- Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  role VARCHAR(50) DEFAULT 'admin',      -- –†–æ–ª—å (admin, super_admin)
  is_active BOOLEAN DEFAULT true,        -- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç–∞
  created_at TIMESTAMP DEFAULT NOW(),    -- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  updated_at TIMESTAMP DEFAULT NOW(),    -- –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  created_by UUID REFERENCES auth.users  -- –ö—Ç–æ –¥–æ–±–∞–≤–∏–ª –∞–¥–º–∏–Ω–∞
);
```

### –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant A as Supabase Auth
    participant C as CRM Check
    participant T as admin_users
    participant D as CRM Dashboard

    U->>A: –õ–æ–≥–∏–Ω + –ø–∞—Ä–æ–ª—å
    A->>C: –£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    C->>T: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ admin_users
    T-->>C: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    
    alt –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∞–¥–º–∏–Ω
        C->>A: –í—ã—Ö–æ–¥ –∏–∑ —Å–µ—Å—Å–∏–∏
        C->>U: –û—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ
    else –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
        C->>D: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω
    end
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **Row Level Security (RLS)**
   - –í–∫–ª—é—á–µ–Ω–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `admin_users`
   - –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∞–º–∏

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Ö–æ–¥**
   - –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ Supabase —Å–µ—Å—Å–∏–∏

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Supabase Auth
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∞–¥–º–∏–Ω–∞

## üéØ –†–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### `admin` (–û–±—ã—á–Ω—ã–π –∞–¥–º–∏–Ω)
- –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º CRM
- –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–¥–µ–ª—è–º–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- –ù–ï –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤

### `super_admin` (–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω)
- –í—Å–µ –ø—Ä–∞–≤–∞ –æ–±—ã—á–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
- –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –î–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç
–î–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç `admin@spody.app` / `admin123` –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

### –†–µ–∑–µ—Ä–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø
–í —Å–ª—É—á–∞–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤, –º–æ–∂–Ω–æ:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞ —á–µ—Ä–µ–∑ SQL –≤ Supabase
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ service_role –∫–ª—é—á

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –õ–æ–≥–∏ –≤—Ö–æ–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üìä –°—Ç–∞—Ç—É—Å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- ‚úÖ **–ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω** - –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞** - –≥–æ—Ç–æ–≤–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
- ‚úÖ **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–æ—Ç–æ–≤** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin-users`
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** - –º–∏–≥—Ä–∞—Ü–∏—è –≤ Supabase

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é** –≤ Supabase (–®–∞–≥ 1-2)
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É** (–®–∞–≥ 3)
3. **–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∞–¥–º–∏–Ω–æ–≤** (–®–∞–≥ 4)
4. **–û–±–Ω–æ–≤–∏—Ç—å Memory Bank** –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

---

**–ö–æ–Ω—Ç–∞–∫—Ç:** –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ Memory Bank –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. 